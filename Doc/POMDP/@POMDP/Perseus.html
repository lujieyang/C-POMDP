<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of Perseus</title>
  <meta name="keywords" content="Perseus">
  <meta name="description" content="The Perseus point-based POMDP solver.">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<table width="810" border="0" align="center" cellpadding="0" cellspacing="0" bgcolor="#FFFFFF">
  <tr>
    <td>
      <img src="../../top.png" alt="Institut de Rob&ograve;tica i Inform&agrave;tica Industrial" width="775" height="60" border="0" USEMAP="#logos"/></td>
      <map name="logos">
       <area shape="rect" coords="740,0,775,60" href="http://www.csic.es" target="_blank">
       <area shape="circle" coords="706,29,20" href="http://www.upc.edu" target="_blank">
       <area shape="rect" coords ="0,0,740,60" href="http://www-iri.upc.es" target="_blank">
      </map>
    </td>
  </tr>
  <tr>
    <td>


<a name="_top"></a>
<!-- # POMDP --><!-- # @POMDP -->
<h1>Perseus
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>The Perseus point-based POMDP solver.</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function [V Value Alpha t]=Perseus(P,B,stopCriteria) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment">   The Perseus point-based POMDP solver.

   Perseus algorithm.
   A point-based solver for POMDP.
   This corresponds to the algorithm in Table 2 (Section 6.1) of the paper.

   Inputs
      P: A POMDP object. This can be any of the specializations of the
         POMDP (discrete/continuous states/actions/observations).
      B: A set of beliefs.
      stopCriteria: A function with 3 parameters (planning horizon,
                    execution time, maximum change in the value for all
                    beliefs in B in the last iteration).
                    The function returns true if the main loop of Perseus
                    must be stopped.
   Outputs
      V: A cell array of policies. V{n} is the policy for planning 
         horizon 'n'.
      Value: A cell array of vectors. Value{n}(i) is the value for belief
             'i' in planning horizon 'n'.
      Alpha: A cell array of vectors. Alpha{n}(i) is the alpha assigned to
             belief 'i' in planning horizon 'n'.
      t: A vector. t(n) is the time taken to compute the policy for
         planning horizon 'n'.</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="../.././@Policy/AddAlpha.html" class="code" title="function [P id]=AddAlpha(P,element,action)">AddAlpha</a>	Adds a new alpha-element to a policy.</li><li><a href="../.././@Policy/MaxAlpha.html" class="code" title="function [nAlpha v]=MaxAlpha(P,b)">MaxAlpha</a>	Returns the maximizing alpha-element for a belief.</li><li><a href="../.././@Policy/Policy.html" class="code" title="function P=Policy(varargin)">Policy</a>	Policy constructor.</li><li><a href="../.././@Policy/size.html" class="code" title="function s=size(P)">size</a>	Returns the size of a policy.</li><li><a href="../.././ActionModel/@CS_CA_ActionModel/DiscretizeActionModel.html" class="code" title="function CS_DA_AM=DiscretizeActionModel(CS_CA_AM,A)">DiscretizeActionModel</a>	Generates a new action model discretizing the action space.</li><li><a href="../.././ActionModel/@CS_DA_ActionModel/DiscretizeActionModel.html" class="code" title="function DAM=DiscretizeActionModel(AM,DS)">DiscretizeActionModel</a>	Produces a new action model discretizing the state space.</li><li><a href="../.././ActionModel/@DS_CA_ActionModel/DiscretizeActionModel.html" class="code" title="function DS_DA_AM=DiscretizeActionModel(DS_CA_AM,ActionSet)">DiscretizeActionModel</a>	Generates a new action model discretizing the action space of the given model.</li><li><a href="../.././Belief/@DBelief/Expectation.html" class="code" title="function e=Expectation(b,a)">Expectation</a>	Expectation between a belief and a alpha-element.</li><li><a href="../.././Belief/@DBelief/rand.html" class="code" title="function v=rand(b)">rand</a>	Random state from a discrete belief.</li><li><a href="../.././Belief/@GBelief/Expectation.html" class="code" title="function e=Expectation(b,a)">Expectation</a>	Expectation between a belief and a alpha-element.</li><li><a href="../.././Belief/@PBelief/Expectation.html" class="code" title="function e=Expectation(b,a)">Expectation</a>	Expectation between a belief and a alpha-element.</li><li><a href="../.././Belief/@PBelief/rand.html" class="code" title="function v=rand(b)">rand</a>	Random state from a belief.</li><li><a href="../.././Lib/@GMixture/Value.html" class="code" title="function v=Value(gm,x)">Value</a>	Evaluates a GMixture.</li><li><a href="../.././Lib/@GMixture/rand.html" class="code" title="function v=rand(gm,varargin)">rand</a>	Generates random points on a GMixture.</li><li><a href="../.././Lib/@Gaussian/Value.html" class="code" title="function v=Value(g,x)">Value</a>	Evaluation of a Gaussian.</li><li><a href="../.././Lib/@Gaussian/rand.html" class="code" title="function r=rand(g,varargin)">rand</a>	Generates random ponts on a Gaussian.</li><li><a href="../.././POMDP/@CS_CO_CA_POMDP/DiscretizeActionModel.html" class="code" title="function DA_POMDP=DiscretizeActionModel(CA_POMDP,optimalAction,iteration)">DiscretizeActionModel</a>	Discretizes the action space CS_CO_CA_POMDP.</li><li><a href="../.././POMDP/@CS_DO_CA_POMDP/DiscretizeActionModel.html" class="code" title="function DA_POMDP=DiscretizeActionModel(CA_POMDP,optimalAction,iteration)">DiscretizeActionModel</a>	Discretizes the action space CS_DO_CA_POMDP.</li><li><a href="../.././POMDP/@CS_POMDP/Alpha0.html" class="code" title="function a=Alpha0(P)">Alpha0</a>	Alpha-element for the first Perseus iteration (continuos state version).</li><li><a href="../.././POMDP/@CS_POMDP/Backup.html" class="code" title="function [alpha a v]=Backup(P,b,V,Alphas_j_a_o)">Backup</a>	Backup for a given belief (continuous state version).</li><li><a href="../.././POMDP/@DS_DO_CA_POMDP/DiscretizeActionModel.html" class="code" title="function DA_POMDP=DiscretizeActionModel(CA_POMDP,optimalAction,iteration)">DiscretizeActionModel</a>	Discretizes the action space DS_DO_CA_POMDP.</li><li><a href="../.././POMDP/@DS_POMDP/Alpha0.html" class="code" title="function a=Alpha0(P)">Alpha0</a>	Alpha-element for the first Perseus iteration (discrete state version).</li><li><a href="../.././POMDP/@DS_POMDP/Backup.html" class="code" title="function [alpha a v]=Backup(P,b,V,Alphas_j_a_o)">Backup</a>	Backupt for a given belief (discrete state version).</li><li><a href="ComputeAlphas_j_a_o.html" class="code" title="function As=ComputeAlphas_j_a_o(P,V)">ComputeAlphas_j_a_o</a>	Computes the set of al possible alpha-elements.</li><li><a href="DiscretizeActionModel.html" class="code" title="function POut=DiscretizeActionModel(P,a,n)">DiscretizeActionModel</a>	Discretizes a POMDP on the action side.</li><li><a href="RandomAction.html" class="code" title="function a=RandomAction(P)">RandomAction</a>	Draws a random action from a POMDP.</li><li><a href="../.././Space/@CSpace/max.html" class="code" title="function m=max(S)">max</a>	Upper bound of a CSpace</li><li><a href="../.././Space/@CSpace/rand.html" class="code" title="function v=rand(CS)">rand</a>	Random state from a continuous space.</li><li><a href="../.././Space/@DSpace/rand.html" class="code" title="function v=rand(DS)">rand</a>	Random state from a discrete space.</li></ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="../.././Experiments/GenerateFigure5Data.html" class="code" title="function GenerateFigure5Data(fname)">GenerateFigure5Data</a>	Generates the data for Figure 5.</li><li><a href="../.././Experiments/GenerateFigure7aData.html" class="code" title="function GenerateFigure7aData(fname)">GenerateFigure7aData</a>	Generates the data for Figure 7-left.</li></ul>
<!-- crossreference -->


<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [V Value Alpha t]=Perseus(P,B,stopCriteria)</a>
0002 <span class="comment">%   The Perseus point-based POMDP solver.</span>
0003 <span class="comment">%</span>
0004 <span class="comment">%   Perseus algorithm.</span>
0005 <span class="comment">%   A point-based solver for POMDP.</span>
0006 <span class="comment">%   This corresponds to the algorithm in Table 2 (Section 6.1) of the paper.</span>
0007 <span class="comment">%</span>
0008 <span class="comment">%   Inputs</span>
0009 <span class="comment">%      P: A POMDP object. This can be any of the specializations of the</span>
0010 <span class="comment">%         POMDP (discrete/continuous states/actions/observations).</span>
0011 <span class="comment">%      B: A set of beliefs.</span>
0012 <span class="comment">%      stopCriteria: A function with 3 parameters (planning horizon,</span>
0013 <span class="comment">%                    execution time, maximum change in the value for all</span>
0014 <span class="comment">%                    beliefs in B in the last iteration).</span>
0015 <span class="comment">%                    The function returns true if the main loop of Perseus</span>
0016 <span class="comment">%                    must be stopped.</span>
0017 <span class="comment">%   Outputs</span>
0018 <span class="comment">%      V: A cell array of policies. V{n} is the policy for planning</span>
0019 <span class="comment">%         horizon 'n'.</span>
0020 <span class="comment">%      Value: A cell array of vectors. Value{n}(i) is the value for belief</span>
0021 <span class="comment">%             'i' in planning horizon 'n'.</span>
0022 <span class="comment">%      Alpha: A cell array of vectors. Alpha{n}(i) is the alpha assigned to</span>
0023 <span class="comment">%             belief 'i' in planning horizon 'n'.</span>
0024 <span class="comment">%      t: A vector. t(n) is the time taken to compute the policy for</span>
0025 <span class="comment">%         planning horizon 'n'.</span>
0026 <span class="comment">%</span>
0027   
0028   <span class="comment">% Get the number of beliefs in the set B</span>
0029   nb=<a href="../.././@Policy/size.html" class="code" title="function s=size(P)">size</a>(B,2);
0030 
0031   <span class="comment">% Set up the initial policy (policy with planning horizon=1)</span>
0032   n=1;                   
0033   V{n}=<a href="../.././@Policy/Policy.html" class="code" title="function P=Policy(varargin)">Policy</a>;
0034   alpha0=<a href="../.././POMDP/@CS_POMDP/Alpha0.html" class="code" title="function a=Alpha0(P)">Alpha0</a>(P);
0035   V{n}=<a href="../.././@Policy/AddAlpha.html" class="code" title="function [P id]=AddAlpha(P,element,action)">AddAlpha</a>(V{n},alpha0,<a href="RandomAction.html" class="code" title="function a=RandomAction(P)">RandomAction</a>(P));
0036   
0037   [Alpha{n} <a href="../.././Lib/@GMixture/Value.html" class="code" title="function v=Value(gm,x)">Value</a>{n}]=cellfun(@(b)(<a href="../.././@Policy/MaxAlpha.html" class="code" title="function [nAlpha v]=MaxAlpha(P,b)">MaxAlpha</a>(V{n},b)),B);
0038     
0039   <span class="comment">% And now start the itarations to improve the policy</span>
0040   t_init=cputime;
0041   stop=false;
0042   
0043   <span class="keyword">while</span> ~stop
0044     
0045     n1=n+1; <span class="comment">% Horizon for the new policy to compute</span>
0046     fprintf(<span class="string">'    Iteration %u: '</span>,n1);
0047     
0048     <span class="comment">% Pre-compute the set of \Alphas_j_a_o</span>
0049     <span class="comment">% This is only feasible in some types of POMDPs</span>
0050     <span class="comment">% In the rest of cases the output is empty</span>
0051     fprintf(<span class="string">'[P'</span>)
0052     Alphas_j_a_o=<a href="ComputeAlphas_j_a_o.html" class="code" title="function As=ComputeAlphas_j_a_o(P,V)">ComputeAlphas_j_a_o</a>(P,V{n});
0053     fprintf(<span class="string">'] '</span>);
0054     
0055     <span class="comment">% The new policy is initially empty</span>
0056     V{n1}=<a href="../.././@Policy/Policy.html" class="code" title="function P=Policy(varargin)">Policy</a>;
0057     
0058     <span class="comment">% Initially all beliefs in B are to be improved</span>
0059     pending=true(1,nb);
0060     nPending=nb;
0061     it=1;
0062     <span class="keyword">while</span> nPending&gt;0
0063       fprintf(<span class="string">'%u(%u)'</span>,it,nPending);
0064       it=it+1;
0065       
0066       <span class="comment">% Select a belief pending to be improved at random</span>
0067       ndx=find(pending); 
0068       nPending=<a href="../.././@Policy/size.html" class="code" title="function s=size(P)">size</a>(ndx,2);
0069       cb=ndx(ceil(<a href="../.././Belief/@DBelief/rand.html" class="code" title="function v=rand(b)">rand</a>*nPending));
0070      
0071       <span class="comment">% POMDP with continouos action sets are converted to their discrete</span>
0072       <span class="comment">% counterparts by sampling actions.</span>
0073       <span class="comment">% We sample a set of actions (taking into accound the action previously</span>
0074       <span class="comment">% assigned to the belief and the planning horizon).</span>
0075       [alpha action]=V{n}{Alpha{n}(cb)};
0076       P1=<a href="DiscretizeActionModel.html" class="code" title="function POut=DiscretizeActionModel(P,a,n)">DiscretizeActionModel</a>(P,action,n);
0077       
0078       <span class="comment">% Execute the backup (this is a different function given different</span>
0079       <span class="comment">% types of POMDP)</span>
0080       fprintf(<span class="string">'b['</span>);
0081       [alpha optimalAction v]=<a href="../.././POMDP/@CS_POMDP/Backup.html" class="code" title="function [alpha a v]=Backup(P,b,V,Alphas_j_a_o)">Backup</a>(P1,B{cb},V{n},Alphas_j_a_o);
0082       fprintf(<span class="string">']'</span>);
0083       
0084       <span class="comment">% If the new value is not better that the one in the previous</span>
0085       <span class="comment">% planning horizon, use the previous alpha.</span>
0086       <span class="keyword">if</span> v&lt;<a href="../.././Lib/@GMixture/Value.html" class="code" title="function v=Value(gm,x)">Value</a>{n}(cb)
0087         [alpha optimalAction]=V{n}{Alpha{n}(cb)}; 
0088         fprintf(<span class="string">'p '</span>);
0089       <span class="keyword">else</span>
0090         fprintf(<span class="string">'n '</span>);
0091       <span class="keyword">end</span>
0092        
0093       <span class="comment">% Add the new alpha to the new policy</span>
0094       [V{n1} l]=<a href="../.././@Policy/AddAlpha.html" class="code" title="function [P id]=AddAlpha(P,element,action)">AddAlpha</a>(V{n1},alpha,optimalAction);
0095       
0096       <span class="keyword">for</span> i=1:nb
0097         <span class="keyword">if</span> pending(i)
0098           nv=<a href="../.././Belief/@DBelief/Expectation.html" class="code" title="function e=Expectation(b,a)">Expectation</a>(B{i},alpha);
0099           <span class="keyword">if</span> nv&gt;=<a href="../.././Lib/@GMixture/Value.html" class="code" title="function v=Value(gm,x)">Value</a>{n}(i)
0100             pending(i)=false;
0101             nPending=nPending-1;
0102             <a href="../.././Lib/@GMixture/Value.html" class="code" title="function v=Value(gm,x)">Value</a>{n1}(i)=nv;
0103             Alpha{n1}(i)=l;
0104           <span class="keyword">end</span>
0105         <span class="keyword">end</span>
0106       <span class="keyword">end</span>
0107       
0108     <span class="keyword">end</span> <span class="comment">%  while nPending&gt;0</span>
0109     
0110     <span class="comment">%[Alpha{n1} Value{n1}]=cellfun(@(b)(MaxAlpha(V{n1},b)),B);</span>
0111   
0112     t(n1)=cputime-t_init; 
0113     vd=<a href="../.././Lib/@GMixture/Value.html" class="code" title="function v=Value(gm,x)">Value</a>{n1}-<a href="../.././Lib/@GMixture/Value.html" class="code" title="function v=Value(gm,x)">Value</a>{n};
0114     mvd=<a href="../.././Space/@CSpace/max.html" class="code" title="function m=max(S)">max</a>(vd);
0115     avd=sum(vd)/nb;
0116 
0117     fprintf(<span class="string">'\n                     mvd:%g  avd: %g  t: %f\n'</span>,mvd,avd,t(n1));
0118     
0119     n=n1; 
0120     
0121     stop=stopCriteria(n,t(n),mvd);
0122   <span class="keyword">end</span>
0123   
0124</pre></div>
<br>
<br>

  </table>
 <table width="810" height="35" border="0" align="center" cellpadding="0" background="../../espai.png">
  <tr>
    <td>
      <span class="footer" align="center"><center>
        <a href="http://www-iri.upc.es"  target="_blank">Institut de Rob&ograve;tica i Inform&agrave;tica Industrial</a>
      </center></span>
    </td>
  </tr>
</table>

<hr><address>Generated on Wed 05-Aug-2009 15:05:21 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2003</address>
</body>
</html>